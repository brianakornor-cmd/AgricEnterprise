<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
<meta name="theme-color" content="#1a3d2b"/>
<meta name="description" content="AgricEntrepreneuring - Smart crop guidance for Ghanaian farmers"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="AgricEnt"/>
<meta name="mobile-web-app-capable" content="yes"/>
<title>AgricEntrepreneuring</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,500;0,700;1,500&family=Lato:wght@300;400;700&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
:root{
  --gd:#1a3d2b;--gm:#2d6a4f;--gl:#52b788;--amber:#e8a021;
  --cream:#f8f4ed;--text:#1c1c1c;--soft:#5a5a5a;
  --sh:0 4px 24px rgba(26,61,43,.13);--shl:0 12px 48px rgba(26,61,43,.22);
}
html,body{height:100%;overflow-x:hidden;}
body{font-family:'Lato',sans-serif;background:var(--cream);color:var(--text);}
::-webkit-scrollbar{width:5px;}::-webkit-scrollbar-track{background:var(--cream);}::-webkit-scrollbar-thumb{background:var(--gl);border-radius:3px;}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
@keyframes scanLine{0%{top:0;}100%{top:100%;}}
@keyframes spin{to{transform:rotate(360deg);}}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.4;}}
.fadeUp{animation:fadeUp .45s ease both;}
.d1{animation-delay:.06s;}.d2{animation-delay:.12s;}.d3{animation-delay:.18s;}.d4{animation-delay:.24s;}.d5{animation-delay:.30s;}.d6{animation-delay:.36s;}.d7{animation-delay:.42s;}.d8{animation-delay:.48s;}
.nav{position:fixed;top:0;left:0;right:0;z-index:200;background:var(--gd);display:flex;align-items:center;justify-content:space-between;padding:0 16px;height:58px;box-shadow:0 2px 16px rgba(0,0,0,.35);}
.nav-logo{font-family:'Playfair Display',serif;font-size:1.2rem;color:var(--amber);display:flex;align-items:center;gap:8px;cursor:pointer;user-select:none;}
.nav-tabs{display:flex;gap:2px;}
.nav-tab{padding:8px 12px;border-radius:8px;border:none;background:transparent;color:rgba(255,255,255,.65);font-family:'Lato',sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:5px;}
.nav-tab:hover{background:rgba(255,255,255,.12);color:#fff;}
.nav-tab.active{background:var(--gl);color:#fff;font-weight:700;}
.tab-lbl{display:none;}
@media(min-width:480px){.tab-lbl{display:inline;}}
.main{margin-top:58px;min-height:calc(100vh - 58px);}
.hero{background:linear-gradient(135deg,var(--gd) 0%,var(--gm) 60%,#1e5c3a 100%);padding:48px 20px 72px;position:relative;overflow:hidden;}
.hero::before{content:'';position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/svg%3E");}
.hero-inner{max-width:860px;margin:0 auto;position:relative;z-index:1;}
.hero-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.2);color:rgba(255,255,255,.9);padding:5px 14px;border-radius:999px;font-size:.75rem;letter-spacing:.08em;text-transform:uppercase;margin-bottom:18px;}
.hero h1{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,5vw,3.2rem);color:#fff;line-height:1.15;margin-bottom:16px;}
.hero h1 span{color:var(--amber);font-style:italic;}
.hero p{color:rgba(255,255,255,.75);font-size:1rem;line-height:1.7;max-width:520px;}
.season-wrap{max-width:860px;margin:-36px auto 0;padding:0 16px;position:relative;z-index:10;}
.season-banner{background:#fff;border-radius:16px;padding:18px 20px;box-shadow:var(--shl);display:flex;align-items:center;gap:16px;flex-wrap:wrap;}
.s-icon{font-size:2.4rem;}
.s-info{flex:1;min-width:180px;}
.s-lbl{font-size:.7rem;text-transform:uppercase;letter-spacing:.1em;color:var(--soft);margin-bottom:2px;}
.s-name{font-family:'Playfair Display',serif;font-size:1.2rem;color:var(--gd);}
.s-desc{font-size:.82rem;color:var(--soft);margin-top:2px;line-height:1.5;}
.s-meta{text-align:right;}
.s-date{font-size:.88rem;font-weight:700;color:var(--gm);}
.s-time{font-size:.78rem;color:var(--soft);}
.loc-btn{display:inline-flex;align-items:center;gap:5px;font-size:.78rem;color:var(--gm);cursor:pointer;padding:5px 11px;background:#e8f5ee;border-radius:999px;margin-top:6px;border:none;font-family:'Lato',sans-serif;transition:all .2s;}
.loc-btn:hover{background:var(--gl);color:#fff;}
.section{max-width:860px;margin:0 auto;padding:40px 16px;}
.sec-title{font-family:'Playfair Display',serif;font-size:1.6rem;color:var(--gd);margin-bottom:6px;}
.sec-sub{font-size:.9rem;color:var(--soft);margin-bottom:24px;line-height:1.6;}
.crops-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px;}
.crop-card{background:#fff;border-radius:14px;padding:20px 16px;cursor:pointer;transition:all .28s;border:2px solid transparent;box-shadow:0 2px 10px rgba(0,0,0,.06);display:flex;flex-direction:column;gap:8px;}
.crop-card:hover{transform:translateY(-5px);box-shadow:var(--shl);border-color:var(--gl);}
.crop-emoji{font-size:2.5rem;}
.crop-cat{font-size:.68rem;text-transform:uppercase;letter-spacing:.08em;padding:2px 9px;border-radius:999px;font-weight:700;width:fit-content;}
.crop-name{font-family:'Playfair Display',serif;font-size:1rem;color:var(--gd);}
.crop-local{font-size:.78rem;color:var(--soft);font-style:italic;}
.crop-dur{font-size:.78rem;color:var(--soft);}
.detail-hero{padding:36px 20px 72px;position:relative;overflow:hidden;}
.back-btn{display:inline-flex;align-items:center;gap:7px;color:#fff;background:rgba(255,255,255,.15);border:none;padding:7px 14px;border-radius:999px;cursor:pointer;font-family:'Lato',sans-serif;font-size:.88rem;margin-bottom:22px;transition:all .2s;}
.back-btn:hover{background:rgba(255,255,255,.25);}
.d-title{font-family:'Playfair Display',serif;font-size:clamp(1.7rem,4vw,2.8rem);color:#fff;display:flex;align-items:center;gap:12px;}
.d-sub{color:rgba(255,255,255,.7);font-size:.95rem;margin-top:6px;font-style:italic;}
.detail-body{max-width:860px;margin:0 auto;padding:0 16px 56px;}
.d-stats{background:#fff;border-radius:14px;padding:20px;box-shadow:var(--sh);margin:-36px auto 32px;display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:14px;}
.stat{text-align:center;}
.stat-val{font-family:'Playfair Display',serif;font-size:1rem;color:var(--gd);}
.stat-lbl{font-size:.7rem;text-transform:uppercase;letter-spacing:.08em;color:var(--soft);margin-top:2px;}
.d-tabs{display:flex;gap:8px;margin-bottom:28px;flex-wrap:wrap;}
.d-tab{padding:9px 18px;border-radius:999px;border:2px solid #e0e0e0;background:#fff;font-family:'Lato',sans-serif;font-size:.86rem;cursor:pointer;transition:all .2s;color:var(--soft);}
.d-tab:hover{border-color:var(--gl);color:var(--gm);}
.d-tab.active{background:var(--gd);border-color:var(--gd);color:#fff;font-weight:700;}
.timeline{position:relative;padding-left:30px;}
.timeline::before{content:'';position:absolute;left:6px;top:0;bottom:0;width:2px;background:linear-gradient(to bottom,var(--gl),var(--amber));}
.tl-item{position:relative;margin-bottom:26px;}
.tl-dot{position:absolute;left:-26px;top:4px;width:13px;height:13px;border-radius:50%;background:var(--gl);border:3px solid #fff;box-shadow:0 0 0 2px var(--gl);}
.tl-week{font-size:.7rem;text-transform:uppercase;letter-spacing:.08em;color:var(--amber);font-weight:700;margin-bottom:3px;}
.tl-phase{font-weight:700;color:var(--gd);margin-bottom:3px;font-size:.95rem;}
.tl-desc{font-size:.87rem;color:var(--soft);line-height:1.6;}
.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px;}
.info-card{background:#fff;border-radius:12px;padding:18px;box-shadow:var(--sh);}
.ic-title{font-weight:700;color:var(--gd);margin-bottom:10px;display:flex;align-items:center;gap:7px;font-size:.9rem;flex-wrap:wrap;}
.tags{display:flex;flex-wrap:wrap;gap:6px;}
.tag{padding:3px 11px;border-radius:999px;font-size:.77rem;background:#f0f7f3;color:var(--gm);border:1px solid #c8e6d6;}
.tag.red{background:#fef0f0;color:#c0392b;border-color:#f5c6c2;}
.scanner-section{max-width:860px;margin:0 auto;padding:0 16px 56px;}
.scan-box{background:#fff;border-radius:18px;overflow:hidden;box-shadow:var(--shl);}
.scan-video-wrap{position:relative;background:#0a1a12;min-height:280px;display:flex;align-items:center;justify-content:center;}
.scan-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;}
.scan-frame{width:220px;height:220px;position:relative;}
.sf-tl{position:absolute;top:0;left:0;width:44px;height:44px;border-top:3px solid var(--gl);border-left:3px solid var(--gl);}
.sf-tr{position:absolute;top:0;right:0;width:44px;height:44px;border-top:3px solid var(--gl);border-right:3px solid var(--gl);}
.sf-bl{position:absolute;bottom:0;left:0;width:44px;height:44px;border-bottom:3px solid var(--gl);border-left:3px solid var(--gl);}
.sf-br{position:absolute;bottom:0;right:0;width:44px;height:44px;border-bottom:3px solid var(--gl);border-right:3px solid var(--gl);}
.scan-line{position:absolute;left:0;right:0;height:2px;background:linear-gradient(to right,transparent,var(--gl),transparent);animation:scanLine 2s linear infinite;}
.scan-placeholder{text-align:center;padding:48px 20px;}
.sp-emoji{font-size:3.5rem;margin-bottom:14px;}
.sp-text{color:rgba(255,255,255,.55);font-size:.9rem;line-height:1.6;}
.scan-controls{padding:20px;display:flex;flex-direction:column;gap:12px;}
.scan-btns{display:flex;gap:10px;flex-wrap:wrap;}
.btn{padding:13px 22px;border-radius:11px;border:none;cursor:pointer;font-family:'Lato',sans-serif;font-size:.9rem;font-weight:700;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:7px;flex:1;}
.btn-green{background:var(--gd);color:#fff;}
.btn-green:hover{background:var(--gm);transform:translateY(-2px);box-shadow:0 7px 18px rgba(26,61,43,.3);}
.btn-amber{background:var(--amber);color:#fff;}
.btn-amber:hover{background:#d4911b;transform:translateY(-2px);}
.btn-out{background:#fff;color:var(--gd);border:2px solid var(--gl);flex:0 0 auto;}
.btn-out:hover{background:var(--gl);color:#fff;}
.btn:disabled{opacity:.5;cursor:not-allowed;transform:none!important;}
.scan-tip{font-size:.77rem;color:var(--soft);text-align:center;}
.result-card{background:#fff;border-radius:14px;padding:24px;box-shadow:var(--sh);margin-top:20px;animation:fadeUp .45s ease;}
.result-hd{display:flex;align-items:center;gap:12px;margin-bottom:14px;flex-wrap:wrap;}
.r-status{padding:6px 16px;border-radius:999px;font-weight:700;font-size:.83rem;text-transform:uppercase;letter-spacing:.06em;}
.rs-good{background:#e6f7ef;color:#1a7a45;}
.rs-bad{background:#fde9e9;color:#c0392b;}
.rs-warn{background:#fff3e0;color:#e67e22;}
.r-condition{font-weight:700;color:var(--gd);margin-bottom:12px;font-size:.98rem;}
.r-section-lbl{font-size:.75rem;text-transform:uppercase;letter-spacing:.08em;color:var(--soft);font-weight:700;margin-bottom:8px;}
.r-item{display:flex;gap:8px;margin-bottom:5px;font-size:.88rem;color:var(--text);line-height:1.55;}
.r-rec-box{background:#f3f9f5;border-radius:10px;padding:14px;margin-top:12px;}
.analyzing-card{background:#fff;border-radius:14px;padding:40px 24px;text-align:center;box-shadow:var(--sh);margin-top:20px;animation:fadeUp .45s ease;}
.analyzing-emoji{font-size:3rem;margin-bottom:14px;animation:pulse 1.5s ease infinite;}
.sched-section{max-width:860px;margin:0 auto;padding:0 16px 56px;}
.live-clock{background:#fff;border-radius:16px;padding:22px;box-shadow:var(--sh);margin-bottom:24px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;}
.lc-lbl{font-size:.7rem;text-transform:uppercase;letter-spacing:.1em;color:var(--soft);}
.lc-date{font-family:'Playfair Display',serif;font-size:1.3rem;color:var(--gd);}
.lc-time{font-size:1.8rem;font-family:monospace;color:var(--gm);margin-top:2px;}
.cal-card{background:#fff;border-radius:16px;padding:22px;box-shadow:var(--sh);margin-bottom:24px;}
.cal-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;}
.cal-nav-btn{background:none;border:none;cursor:pointer;font-size:1.3rem;padding:6px 10px;border-radius:8px;color:var(--gd);}
.cal-nav-btn:hover{background:#e8f5ee;}
.cal-month-lbl{font-family:'Playfair Display',serif;font-size:1.3rem;color:var(--gd);}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:14px;}
.cal-hd{text-align:center;font-size:.68rem;text-transform:uppercase;letter-spacing:.07em;color:var(--soft);padding:6px 0;}
.cal-d{aspect-ratio:1;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:.86rem;cursor:pointer;transition:all .15s;position:relative;}
.cal-d:hover{background:#e8f5ee;}
.cal-d.today{background:var(--gd);color:#fff;font-weight:700;}
.cal-d.has-ev::after{content:'';position:absolute;bottom:3px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:var(--amber);}
.cal-d.empty{cursor:default;}
.cal-legend{display:flex;align-items:center;gap:14px;font-size:.77rem;color:var(--soft);}
.leg-dot{width:10px;height:10px;border-radius:3px;display:inline-block;margin-right:4px;}
.events-list{display:flex;flex-direction:column;gap:10px;}
.ev-card{background:#fff;border-radius:12px;padding:14px 16px;box-shadow:var(--sh);display:flex;align-items:center;gap:14px;border-left:4px solid var(--gl);}
.ev-date{text-align:center;min-width:46px;}
.ev-day{font-family:'Playfair Display',serif;font-size:1.5rem;color:var(--gd);line-height:1;}
.ev-mo{font-size:.7rem;text-transform:uppercase;color:var(--soft);letter-spacing:.07em;}
.ev-info{flex:1;}
.ev-title{font-weight:700;color:var(--gd);font-size:.9rem;margin-bottom:2px;}
.ev-desc{font-size:.8rem;color:var(--soft);}
.ev-emoji{font-size:1.6rem;}
.season-strip{display:flex;gap:8px;overflow-x:auto;padding:4px 0;margin-bottom:24px;scrollbar-width:none;}
.season-strip::-webkit-scrollbar{display:none;}
.ss-item{flex:0 0 auto;padding:10px 16px;border-radius:10px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.07);text-align:center;min-width:130px;border:2px solid transparent;}
.ss-item.now{border-color:var(--gl);background:#f0faf5;}
.ss-sicon{font-size:1.4rem;margin-bottom:4px;}
.ss-name{font-size:.78rem;font-weight:700;color:var(--gd);}
.ss-months{font-size:.7rem;color:var(--soft);}
.install-banner{background:var(--amber);padding:14px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;}
.ib-text{color:#fff;font-size:.9rem;font-weight:700;}
.ib-sub{color:rgba(255,255,255,.8);font-size:.78rem;}
.ib-btn{background:#fff;color:var(--amber);border:none;padding:9px 18px;border-radius:8px;font-weight:700;font-size:.88rem;cursor:pointer;font-family:'Lato',sans-serif;white-space:nowrap;}
.ib-close{background:none;border:none;color:#fff;font-size:1.6rem;cursor:pointer;padding:0 4px;line-height:1;}
.pwa-note{font-size:.75rem;color:var(--soft);text-align:center;padding:6px 16px 16px;}
</style>
</head>
<body>
<div id="root"></div>
<canvas id="hcanvas" style="display:none;"></canvas>
<script>
// â”€â”€ PWA SETUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if('serviceWorker' in navigator){
  const swCode=`const CACHE='agric-v1';
self.addEventListener('install',e=>{e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['./'])));});
self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)).catch(()=>new Response('Offline - Please reconnect')));});`;
  const swBlob=new Blob([swCode],{type:'application/javascript'});
  navigator.serviceWorker.register(URL.createObjectURL(swBlob)).catch(()=>{});
}
const manifest={name:'AgricEntrepreneuring',short_name:'AgricEnt',description:'Smart crop guidance for Ghanaian farmers',start_url:'.',display:'standalone',background_color:'#f8f4ed',theme_color:'#1a3d2b',orientation:'any',icons:[{src:"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' rx='80' fill='%231a3d2b'/><text y='360' x='80' font-size='360'>ğŸŒ¿</text></svg>",sizes:'512x512',type:'image/svg+xml',purpose:'any maskable'}]};
const mlink=document.createElement('link');
mlink.rel='manifest';
mlink.href=URL.createObjectURL(new Blob([JSON.stringify(manifest)],{type:'application/json'}));
document.head.appendChild(mlink);
const alink=document.createElement('link');
alink.rel='apple-touch-icon';
alink.href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' fill='%231a3d2b'/><text y='360' x='80' font-size='360'>ğŸŒ¿</text></svg>";
document.head.appendChild(alink);

// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CROPS=[
  {id:'maize',name:'Maize (Corn)',emoji:'ğŸŒ½',local:'Aburo (Twi)',cat:'Cereal',seasons:['Major: Marâ€“Jul','Minor: Sepâ€“Nov'],regions:['Brong-Ahafo','Ashanti','Northern'],soil:'Well-drained loamy soil, pH 5.5â€“7.0',spacing:'75cm Ã— 40cm',dur:'90â€“120 days',water:'500â€“800mm/season',yld:'2â€“4 t/ha (improved: 6â€“8 t/ha)',steps:[{p:'Land Prep',w:'Week 1â€“2',d:'Clear land, plough and harrow to fine tilth. Apply basal fertilizer (NPK 15-15-15) at 250kg/ha.'},{p:'Planting',w:'Week 2â€“3',d:'Plant 2 seeds per hole at 4â€“5cm depth. Germination in 7â€“10 days.'},{p:'Thinning',w:'Week 3â€“4',d:'Thin to 1 plant per stand when seedlings reach 15cm tall.'},{p:'First Weeding',w:'Week 3â€“5',d:'Weed thoroughly. Apply herbicide (Atrazine) if needed.'},{p:'Top Dressing',w:'Week 5â€“6',d:'Apply Sulphate of Ammonia (SA) at 250kg/ha when plants are knee-high.'},{p:'Second Weeding',w:'Week 6â€“8',d:'Second weeding before canopy closes. Watch for stem borers.'},{p:'Tasseling',w:'Week 8â€“10',d:'Silking and pollination phase. Ensure adequate moisture.'},{p:'Harvest',w:'Week 13â€“17',d:'Harvest when husks turn brown and dry. Dry cobs to 12â€“14% moisture.'}],pests:['Stem Borer','Armyworm','Aphids','Weevils (storage)'],diseases:['Leaf Blight','Maize Streak Virus','Downy Mildew'],vars:['Obatanpa','Okomasa','Abontem','CIMMYT Hybrids'],color:'#e8a021',bg:'#fdf3dc'},
  {id:'cocoa',name:'Cocoa',emoji:'ğŸ«',local:'Kookoo (Twi)',cat:'Cash Crop',seasons:['Main: Octâ€“Mar','Light: Mayâ€“Aug'],regions:['Ashanti','Brong-Ahafo','Eastern','Western'],soil:'Deep, well-drained loam, pH 6.0â€“7.0, rich organic matter',spacing:'3m Ã— 3m',dur:'3â€“5 years to first harvest',water:'1500â€“2000mm/year',yld:'0.4â€“0.8 t/ha dry beans',steps:[{p:'Nursery',w:'Month 1â€“4',d:'Germinate seeds in polybags under 50% shade. Water daily. Transplant when 30â€“45cm tall.'},{p:'Land Prep',w:'Month 1â€“2',d:'Clear land, establish shade trees (Plantain, Albizia). Mark planting holes 60cm x 60cm x 60cm.'},{p:'Transplanting',w:'Month 4â€“5',d:'Transplant at onset of rains. Apply 100g NPK per hole.'},{p:'Establishment',w:'Year 1â€“2',d:'Regular weeding, pruning of unwanted chupons. Maintain 30â€“50% shade.'},{p:'Fertilization',w:'Year 2+',d:'Apply Sulphate of Ammonia annually in 2 splits: March and September.'},{p:'Pruning',w:'Annual',d:'Prune to maintain jorquette at 1.5m. Remove dead wood and mistletoe.'},{p:'Harvesting',w:'Year 3â€“5+',d:'Harvest ripe pods (yellow/orange). Break pods and extract beans within 5 days.'},{p:'Fermentation and Drying',w:'Post-harvest',d:'Ferment beans 5â€“7 days, then sun-dry to 7â€“8% moisture on raised platforms.'}],pests:['Mirids (Capsids)','Mealybugs','Pod Borers'],diseases:['Black Pod (Phytophthora)','Swollen Shoot Virus (CSSV)',"Witch's Broom"],vars:['Amazon','Hybrid F3','Amelonado','Trinitario'],color:'#7b4f2e',bg:'#f5ece4'},
  {id:'cassava',name:'Cassava',emoji:'ğŸª´',local:'Bankye (Twi)',cat:'Root Crop',seasons:['Major: Marâ€“May','Minor: Sepâ€“Oct'],regions:['All regions'],soil:'Sandy loam to loam, pH 5.5â€“6.5, not waterlogged',spacing:'1m Ã— 1m',dur:'9â€“24 months',water:'1000â€“1500mm/year',yld:'10â€“20 t/ha (improved: 25â€“40 t/ha)',steps:[{p:'Land Prep',w:'Week 1',d:'Plough and harrow. Make mounds or ridges in waterlogged areas.'},{p:'Planting',w:'Week 1â€“2',d:'Cut stems 20â€“30cm long. Plant at 45 angle, 2/3 in soil. Use disease-free stems.'},{p:'First Weeding',w:'Week 4â€“6',d:'Critical weed control period. Weed thoroughly to prevent competition.'},{p:'Fertilization',w:'Week 6â€“8',d:'Apply NPK 15-15-15 at 300kg/ha if soil is poor.'},{p:'Second Weeding',w:'Week 10â€“12',d:'Weed again before canopy closes. Minimal weeding needed after closure.'},{p:'Monitoring',w:'Month 4â€“8',d:'Watch for CBB and CGM pests. Spot spray if infestation is severe.'},{p:'Harvest',w:'Month 9â€“24',d:'Harvest when leaves yellow and fall off. Use fork or hoe. Stagger harvest to extend supply.'}],pests:['Cassava Green Mite (CGM)','Cassava Brown Streak Bug','Whiteflies'],diseases:['Cassava Mosaic Disease (CMD)','Brown Streak Disease (CBSD)','Root Rot'],vars:['Afisiafi','Sika Bankye','Tetteh Quashie','IFAD Cassava'],color:'#b07d49',bg:'#faf0e6'},
  {id:'yam',name:'Yam',emoji:'ğŸ ',local:'Bayere (Twi)',cat:'Root Crop',seasons:['Planting: Decâ€“Feb','Harvest: Augâ€“Nov'],regions:['Brong-Ahafo','Northern','Volta'],soil:'Well-drained, deep sandy loam, pH 5.5â€“7.0',spacing:'1m Ã— 1m on mounds',dur:'7â€“10 months',water:'1000â€“1500mm/year',yld:'15â€“20 t/ha',steps:[{p:'Mound Making',w:'Novâ€“Dec',d:'Make large mounds (100cm dia, 50cm high) during dry season. Add organic matter.'},{p:'Seed Yam Prep',w:'Decâ€“Jan',d:'Use seed yams of 200â€“400g. Apply ash or fungicide to cut surfaces before planting.'},{p:'Planting',w:'Decâ€“Feb',d:'Plant at center of mound, 10â€“15cm deep. Provide staking poles at planting.'},{p:'Staking',w:'Week 3â€“4',d:'Stake when vines emerge. Use 2â€“3m long stakes. Tie vines loosely.'},{p:'First Weeding',w:'Week 4â€“6',d:'Weed mounds carefully to avoid root damage.'},{p:'Top Dressing',w:'Month 2â€“3',d:'Apply NPK or Sulphate of Ammonia at 100g per mound.'},{p:'Earthing Up',w:'Month 4â€“5',d:'Add soil to mounds to cover exposed tubers.'},{p:'Harvest',w:'Month 7â€“10',d:'Harvest at leaf yellowing. Dig carefully, cure tubers 2 weeks before storage.'}],pests:['Yam Beetle','Scale Insects','Millipedes'],diseases:['Yam Mosaic Virus','Anthracnose','Dry Rot'],vars:['Pona','Laribako','Dente','Muchumuchu'],color:'#c4783e',bg:'#fdf0e4'},
  {id:'tomato',name:'Tomato',emoji:'ğŸ…',local:'Tomatoes (Twi)',cat:'Vegetable',seasons:['Major: Octâ€“Feb','Minor: Aprâ€“Jul'],regions:['Brong-Ahafo','Upper East','Greater Accra'],soil:'Well-drained loam or sandy loam, pH 6.0â€“6.8',spacing:'60cm Ã— 50cm',dur:'90â€“120 days',water:'600â€“1200mm/season',yld:'15â€“30 t/ha',steps:[{p:'Nursery',w:'Week 1â€“3',d:'Sow in nursery beds or trays. Germination in 7â€“10 days. Harden before transplanting.'},{p:'Land Prep',w:'Week 2â€“3',d:'Prepare beds with compost. Apply DAP or NPK at 200kg/ha as basal.'},{p:'Transplanting',w:'Week 3â€“4',d:'Transplant 4â€“6 week old seedlings in afternoon or on cloudy days. Water immediately.'},{p:'Staking',w:'Week 5â€“6',d:'Stake or trellis when 30cm tall. Promotes air circulation.'},{p:'Fertilization',w:'Week 5â€“8',d:'Apply CAN at 150kg/ha at 3 and 6 weeks after transplanting.'},{p:'Pruning',w:'Ongoing',d:'Remove suckers for indeterminate varieties. Maintain 1â€“2 main stems.'},{p:'Pest Management',w:'Ongoing',d:'Monitor for fruit fly, leaf miner, whitefly. Spray neem or registered pesticides.'},{p:'Harvest',w:'Week 10â€“17',d:'Harvest red-ripe or breaker stage for local/export markets. Handle gently.'}],pests:['Tomato Fruit Fly','Leaf Miner','Whitefly','Aphids'],diseases:['Early Blight','Late Blight','Fusarium Wilt','Bacterial Wilt'],vars:['Pectomech','Cobra','Petomech','Nagabon'],color:'#d93a2b',bg:'#fdecea'},
  {id:'groundnut',name:'Groundnut',emoji:'ğŸ¥œ',local:'Nkatie (Twi)',cat:'Legume',seasons:['Major: Aprâ€“Aug','Minor: Sepâ€“Dec'],regions:['Upper East','Upper West','Northern'],soil:'Sandy loam, pH 5.8â€“6.2, well-drained',spacing:'45cm Ã— 15cm',dur:'90â€“130 days',water:'500â€“700mm/season',yld:'1â€“2 t/ha pods',steps:[{p:'Land Prep',w:'Week 1',d:'Deep plough in late dry season. Harrow fine. Avoid compaction.'},{p:'Seed Treatment',w:'Week 1',d:'Treat seeds with Rhizobium inoculant and fungicide. Improves nitrogen fixation.'},{p:'Planting',w:'Week 1â€“2',d:'Shell just before planting. Plant 2 seeds per hole at 4cm depth.'},{p:'Weeding',w:'Week 3â€“5',d:'Weed early to avoid competition. Light weeding later to avoid disturbing pegs.'},{p:'Earthing Up',w:'Week 6â€“8',d:'Hill soil around plants to allow pegs to penetrate the ground.'},{p:'Fertilization',w:'Week 2â€“3',d:'Apply phosphorus fertilizer (SSP) at 150kg/ha at planting.'},{p:'Harvest',w:'Week 13â€“19',d:'Harvest when inner pod wall shows dark veins. Shake off soil, dry 2â€“3 weeks.'}],pests:['Rosette Virus Aphid','Thrips','Jassids'],diseases:['Groundnut Rosette','Early Leaf Spot','Aflatoxin (storage)'],vars:['Manipinta','Nkosuor','Obolo','Chinese'],color:'#c9851f',bg:'#fdf4e3'},
  {id:'rice',name:'Rice',emoji:'ğŸŒ¾',local:'Emo (Twi)',cat:'Cereal',seasons:['Major: Aprâ€“Aug','Minor: Sepâ€“Dec'],regions:['Volta','Northern','Brong-Ahafo'],soil:'Heavy clay or loamy, pH 5.5â€“7.0, good water retention',spacing:'20cm Ã— 20cm',dur:'90â€“130 days',water:'1000â€“2000mm/season',yld:'2â€“4 t/ha paddy',steps:[{p:'Nursery',w:'Week 1â€“2',d:'Pre-germinate seeds 24hrs. Broadcast in flooded nursery beds. Transplant at 21 days.'},{p:'Land Prep',w:'Week 1â€“2',d:'Puddle paddies. Level field for uniform water distribution.'},{p:'Transplanting',w:'Week 3',d:'Transplant 3â€“4 seedlings per hill at 20 x 20cm. Plant at 2â€“3cm depth.'},{p:'Water Management',w:'Ongoing',d:'Maintain 5â€“10cm standing water. Drain at panicle initiation for 1 week.'},{p:'Fertilization',w:'Week 3, 6, 9',d:'Apply urea in 3 splits: transplanting, tillering, panicle initiation.'},{p:'Weeding',w:'Week 3â€“5',d:'Apply herbicide (2,4-D) or hand weed 2â€“3 times during early growth.'},{p:'Harvest',w:'Week 13â€“19',d:'Harvest at 80â€“85% grain maturity. Thresh immediately, dry to 14% moisture.'}],pests:['Brown Plant Hopper','Stem Borer','Birds'],diseases:['Rice Blast','Bacterial Leaf Blight','Sheath Rot'],vars:['AGRA Rice','NERICA 1-18','Jasmine 85','Sikamo'],color:'#8fad3f',bg:'#f3f7e6'},
  {id:'plantain',name:'Plantain',emoji:'ğŸŒ',local:'Apem (Twi)',cat:'Fruits',seasons:['Plant any time','Peak: Rainy seasons'],regions:['Ashanti','Eastern','Western','Central'],soil:'Deep, well-drained loam, pH 5.5â€“7.0, rich organic matter',spacing:'3m Ã— 3m',dur:'9â€“12 months to first bunch',water:'1200â€“2500mm/year',yld:'10â€“30 t/ha fresh bunches',steps:[{p:'Sucker Selection',w:'Week 1',d:'Select sword suckers (narrow leaves) 60â€“90cm. Peel to white corm. Treat with pesticide.'},{p:'Land Prep',w:'Week 1',d:'Clear land. Dig planting holes 60cm x 60cm x 60cm. Mix topsoil with compost.'},{p:'Planting',w:'Week 1â€“2',d:'Plant at start of rains. Place sucker upright, fill hole. Do not bury growing point.'},{p:'Fertilization',w:'Month 2, 4, 6',d:'Apply NPK 15-15-15 at 200g per plant, 3 times per year. Mulch to conserve moisture.'},{p:'Desuckering',w:'Ongoing',d:'Retain 1 ratoon (follower) per mat. Remove excess suckers regularly.'},{p:'Propping',w:'Month 8â€“10',d:'Support bunches and plants with bamboo stakes to prevent lodging.'},{p:'Harvest',w:'Month 9â€“12',d:'Harvest when fingers are full and angularity reduces. Cut bunch with machete.'}],pests:['Banana Weevil (Cosmopolites)','Nematodes','Thrips'],diseases:['Black Sigatoka','Fusarium Wilt (Panama)','Bunchy Top Virus'],vars:['Apantu','Apem','Orishele','French Plantain'],color:'#f5c842',bg:'#fffce6'},
];
const SEASONS=[
  {months:[3,4,5,6,7],name:'Major Rainy Season',icon:'ğŸŒ§ï¸',desc:'Primary planting season. Heavy rainfall, ideal for maize, cassava, tomato.'},
  {months:[8],name:'Short Dry Spell',icon:'â˜€ï¸',desc:'Brief dry period. Irrigate if possible or plant drought-tolerant crops.'},
  {months:[9,10,11],name:'Minor Rainy Season',icon:'ğŸŒ¦ï¸',desc:'Secondary planting season. Good for vegetables, groundnuts, second-season maize.'},
  {months:[12,1,2],name:'Dry / Harmattan Season',icon:'ğŸ’¨',desc:'Dry, dusty conditions. Focus on irrigation farming, yam mound prep, and tree crops.'},
];
const MONTHS=['January','February','March','April','May','June','July','August','September','October','November','December'];
const DAYS=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
function getSeason(m){return SEASONS.find(s=>s.months.includes(m))||SEASONS[3];}

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var state={
  page:'home',crop:null,tab:'steps',
  now:new Date(),loc:null,
  calMonth:new Date(),
  camOn:false,scanning:false,result:null,capturedImg:null,
  installEvt:null,installBanner:true,
};
var streamRef=null;
var videoEl=document.createElement('video');
videoEl.autoplay=true;videoEl.playsInline=true;videoEl.muted=true;
videoEl.style.cssText='width:100%;max-height:360px;object-fit:cover;display:block;';
var canvasEl=document.getElementById('hcanvas');

window.addEventListener('beforeinstallprompt',function(e){e.preventDefault();state.installEvt=e;render();});
window.addEventListener('appinstalled',function(){state.installBanner=false;state.installEvt=null;render();});
setInterval(function(){
  state.now=new Date();
  var n=state.now;
  var timeStr=n.toLocaleTimeString('en-GH',{hour:'2-digit',minute:'2-digit'});
  var dateStr=n.toLocaleDateString('en-GH',{weekday:'short',day:'numeric',month:'short',year:'numeric'});
  var fullDate=n.toLocaleDateString('en-GH',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
  var fullTime=n.toLocaleTimeString('en-GH',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
  // Update elements directly without re-rendering
  var el;
  el=document.getElementById('clock-time');if(el)el.textContent=timeStr;
  el=document.getElementById('clock-date');if(el)el.textContent=dateStr;
  el=document.getElementById('sched-time');if(el)el.textContent=fullTime;
  el=document.getElementById('sched-date');if(el)el.textContent=fullDate;
},1000);

// â”€â”€ ACTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window._go=function(page,cropId){
  state.page=page;
  if(cropId) state.crop=CROPS.find(function(c){return c.id===cropId;})||null;
  state.tab='steps';
  window.scrollTo(0,0);
  if(page!=='scanner') stopCam();
  render();
};
window._tab=function(t){state.tab=t;render();};
window._loc=function(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(
      function(p){state.loc={lat:p.coords.latitude.toFixed(3),lon:p.coords.longitude.toFixed(3)};render();},
      function(){state.loc={lat:'5.603',lon:'-0.187'};render();}
    );
  }
};
window._calPrev=function(){state.calMonth=new Date(state.calMonth.getFullYear(),state.calMonth.getMonth()-1);render();};
window._calNext=function(){state.calMonth=new Date(state.calMonth.getFullYear(),state.calMonth.getMonth()+1);render();};
window._startCam=async function(){
  try{
    streamRef=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'},audio:false});
    videoEl.srcObject=streamRef;
    state.camOn=true;state.result=null;state.capturedImg=null;
    render();
    setTimeout(function(){var w=document.getElementById('video-wrap');if(w&&!w.contains(videoEl))w.appendChild(videoEl);},60);
  }catch(err){alert('Camera access denied. Please allow camera permissions and try again.');}
};
window._stopCam=function(){stopCam();state.camOn=false;render();};
function stopCam(){if(streamRef){streamRef.getTracks().forEach(function(t){t.stop();});streamRef=null;}}
window._capture=async function(){
  canvasEl.width=videoEl.videoWidth||640;
  canvasEl.height=videoEl.videoHeight||480;
  canvasEl.getContext('2d').drawImage(videoEl,0,0);
  var b64=canvasEl.toDataURL('image/jpeg',.8).split(',')[1];
  state.capturedImg=canvasEl.toDataURL('image/jpeg',.8);
  stopCam();state.camOn=false;state.scanning=true;state.result=null;
  render();
  try{
    var res=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:1000,messages:[{role:'user',content:[
        {type:'image',source:{type:'base64',media_type:'image/jpeg',data:b64}},
        {type:'text',text:'You are an expert Ghanaian agricultural consultant. Analyze this crop/plant image.\nRespond EXACTLY in this format:\nSTATUS: [HEALTHY or DISEASED or PEST DAMAGE or NUTRIENT DEFICIENCY or UNKNOWN]\nCONDITION: [1 sentence assessment]\nOBSERVATIONS:\n- [observation 1]\n- [observation 2]\n- [observation 3]\nRECOMMENDATIONS:\n- [recommendation 1]\n- [recommendation 2]\n- [recommendation 3]\nURGENCY: [LOW or MEDIUM or HIGH]\n\nBe practical and specific to West African farming conditions.'}
      ]}]})
    });
    var data=await res.json();
    state.result=(data.content&&data.content[0])?data.content[0].text:'Unable to analyze image.';
  }catch(err){
    state.result='STATUS: UNKNOWN\nCONDITION: Analysis failed. Please check your internet connection.\nOBSERVATIONS:\n- Could not process the image\n- Check your internet connection\n- Try again with better lighting\nRECOMMENDATIONS:\n- Ensure good lighting conditions\n- Hold the camera steady and close\n- Consult your local MOFA extension officer\nURGENCY: LOW';
  }
  state.scanning=false;render();
};
window._install=async function(){
  if(state.installEvt){await state.installEvt.prompt();state.installEvt=null;state.installBanner=false;render();}
};
window._closeInstall=function(){state.installBanner=false;render();};

// â”€â”€ PARSE AI RESULT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseResult(txt){
  if(!txt)return null;
  var lines=txt.split('\n');
  function get(k){var l=lines.find(function(x){return x.startsWith(k+':');});return l?l.replace(k+':','').trim():'';}
  function getList(k){
    var i=lines.findIndex(function(x){return x.startsWith(k+':');});
    if(i===-1)return[];
    var out=[];
    for(var j=i+1;j<lines.length;j++){
      if(lines[j].startsWith('-'))out.push(lines[j].replace('-','').trim());
      else if(lines[j].trim()&&!lines[j].startsWith('-'))break;
    }
    return out;
  }
  return{status:get('STATUS'),condition:get('CONDITION'),observations:getList('OBSERVATIONS'),recommendations:getList('RECOMMENDATIONS'),urgency:get('URGENCY')};
}
function statusCls(s){
  if(!s)return'';var u=s.toUpperCase();
  if(u==='HEALTHY')return'rs-good';
  if(u==='UNKNOWN')return'rs-warn';
  return'rs-bad';
}
function esc(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

// â”€â”€ SCHEDULER EVENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getEvents(){
  var evs=[];var n=state.now;
  CROPS.forEach(function(c){
    c.steps.slice(0,2).forEach(function(s,i){
      evs.push({cropName:c.name,emoji:c.emoji,phase:s.p,desc:s.d,month:(n.getMonth()+i)%12,day:5+(i*8)+(CROPS.indexOf(c)*3)%20});
    });
  });
  return evs.slice(0,10);
}

// â”€â”€ RENDER FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderInstallBanner(){
  if(!state.installBanner||!state.installEvt)return'';
  return '<div class="install-banner"><div><div class="ib-text">ğŸ“² Install AgricEnt App</div><div class="ib-sub">Add to your home screen for offline access</div></div><button class="ib-btn" onclick="_install()">Install Now</button><button class="ib-close" onclick="_closeInstall()">x</button></div>';
}

function renderHome(){
  var n=state.now;
  var season=getSeason(n.getMonth()+1);
  var locTxt=state.loc?('ğŸ“ '+state.loc.lat+'N, '+state.loc.lon+'E'):'ğŸ“ Enable Location';
  var dateStr=n.toLocaleDateString('en-GH',{weekday:'short',day:'numeric',month:'short',year:'numeric'});
  var timeStr=n.toLocaleTimeString('en-GH',{hour:'2-digit',minute:'2-digit'});
  var cropsHtml=CROPS.map(function(c,i){
    return '<div class="crop-card fadeUp d'+(Math.min(i+1,8))+'" onclick="_go(\'detail\',\''+c.id+'\')">'+
      '<div class="crop-emoji">'+c.emoji+'</div>'+
      '<span class="crop-cat" style="background:'+c.bg+';color:'+c.color+'">'+c.cat+'</span>'+
      '<div class="crop-name">'+c.name+'</div>'+
      '<div class="crop-local">'+c.local+'</div>'+
      '<div class="crop-dur">â± '+c.dur+'</div>'+
    '</div>';
  }).join('');
  return '<div class="hero">'+
    '<div class="hero-inner">'+
      '<div class="hero-badge fadeUp">ğŸŒ± AgricEntrepreneuring Â· Ghana Focus</div>'+
      '<h1 class="fadeUp d1">Grow smarter.<br/><span>Farm better.</span></h1>'+
      '<p class="fadeUp d2">Your complete agricultural companion â€” crop guides, season tracking, AI crop health scanning, and planting schedules tailored for Ghanaian and West African farmers.</p>'+
    '</div>'+
  '</div>'+
  '<div style="max-width:860px;margin:0 auto;padding:0 16px;">'+
    '<div class="season-banner fadeUp" style="margin-top:-32px;position:relative;z-index:10;">'+
      '<span class="s-icon">'+season.icon+'</span>'+
      '<div class="s-info">'+
        '<div class="s-lbl">Current Season</div>'+
        '<div class="s-name">'+season.name+'</div>'+
        '<div class="s-desc">'+season.desc+'</div>'+
      '</div>'+
      '<div class="s-meta">'+
        '<div class="s-date" id="clock-date">'+dateStr+'</div>'+
        '<div class="s-time" id="clock-time">'+timeStr+'</div>'+
        '<button class="loc-btn" onclick="_loc()">'+locTxt+'</button>'+
      '</div>'+
    '</div>'+
  '</div>'+
  '<div class="section" style="padding-top:32px;">'+
    '<div class="sec-title">ğŸŒ¾ Crop Library</div>'+
    '<div class="sec-sub">Select a crop to view the full planting guide, pest management, seasonal schedule and more.</div>'+
    '<div class="crops-grid">'+cropsHtml+'</div>'+
  '</div>';
}

function renderDetail(){
  var c=state.crop;if(!c)return'';
  var t=state.tab;
  var tabsHtml=[{id:'steps',lbl:'ğŸ“‹ Growing Steps'},{id:'info',lbl:'ğŸŒ± Crop Info'},{id:'pests',lbl:'ğŸ› Pests'},{id:'season',lbl:'ğŸ“… Seasons'}]
    .map(function(x){return '<button class="d-tab'+(t===x.id?' active':'')+'" onclick="_tab(\''+x.id+'\')">'+x.lbl+'</button>';}).join('');
  var statsHtml=[{l:'Duration',v:c.dur,i:'â±'},{l:'Spacing',v:c.spacing,i:'ğŸ“'},{l:'Water',v:c.water,i:'ğŸ’§'},{l:'Yield',v:c.yld,i:'ğŸ“¦'}]
    .map(function(s){return '<div class="stat"><div style="font-size:1.3rem;margin-bottom:3px">'+s.i+'</div><div class="stat-val">'+s.v+'</div><div class="stat-lbl">'+s.l+'</div></div>';}).join('');
  var content='';
  if(t==='steps'){
    content='<div class="timeline fadeUp">'+c.steps.map(function(s){
      return '<div class="tl-item"><div class="tl-dot"></div><div class="tl-week">'+s.w+'</div><div class="tl-phase">'+s.p+'</div><div class="tl-desc">'+s.d+'</div></div>';
    }).join('')+'</div>';
  }else if(t==='info'){
    content='<div class="info-grid fadeUp">'+
      '<div class="info-card"><div class="ic-title">ğŸŒ Regions</div><div class="tags">'+c.regions.map(function(r){return '<span class="tag">'+r+'</span>';}).join('')+'</div></div>'+
      '<div class="info-card"><div class="ic-title">ğŸŒ± Varieties</div><div class="tags">'+c.vars.map(function(v){return '<span class="tag">'+v+'</span>';}).join('')+'</div></div>'+
      '<div class="info-card" style="grid-column:1/-1"><div class="ic-title">ğŸª¨ Soil</div><p style="font-size:.87rem;color:var(--soft);line-height:1.65">'+c.soil+'</p></div>'+
    '</div>';
  }else if(t==='pests'){
    content='<div class="info-grid fadeUp">'+
      '<div class="info-card"><div class="ic-title">ğŸ› Common Pests</div><div class="tags">'+c.pests.map(function(p){return '<span class="tag red">'+p+'</span>';}).join('')+'</div></div>'+
      '<div class="info-card"><div class="ic-title">ğŸ¦  Diseases</div><div class="tags">'+c.diseases.map(function(d){return '<span class="tag red">'+d+'</span>';}).join('')+'</div></div>'+
      '<div class="info-card" style="grid-column:1/-1"><div class="ic-title">ğŸ’¡ IPM Tip</div><p style="font-size:.87rem;color:var(--soft);line-height:1.65">Use Integrated Pest Management (IPM): combine cultural practices (crop rotation, timely planting), biological controls, and chemical sprays only as a last resort. Always follow PPRSD-Ghana approved pesticide labels.</p></div>'+
    '</div>';
  }else if(t==='season'){
    var curM=state.now.getMonth()+1;
    content='<div class="info-grid fadeUp">'+
      '<div class="info-card" style="grid-column:1/-1"><div class="ic-title">ğŸ“… Planting Windows for '+c.name+'</div><div class="tags">'+c.seasons.map(function(s){return '<span class="tag">'+s+'</span>';}).join('')+'</div></div>'+
      SEASONS.map(function(s){
        var isNow=s.months.includes(curM);
        return '<div class="info-card" style="border-left:4px solid '+(isNow?'var(--gl)':'#e0e0e0')+'">'+
          '<div class="ic-title">'+s.icon+' '+s.name+(isNow?' <span style="background:var(--gl);color:#fff;font-size:.68rem;padding:2px 7px;border-radius:999px">NOW</span>':'')+'</div>'+
          '<p style="font-size:.83rem;color:var(--soft);line-height:1.55;margin-bottom:6px">'+s.desc+'</p>'+
          '<div style="font-size:.75rem;color:var(--soft)">Months: '+s.months.map(function(m){return MONTHS[m-1];}).join(', ')+'</div>'+
        '</div>';
      }).join('')+
    '</div>';
  }
  return '<div class="detail-hero" style="background:linear-gradient(135deg,var(--gd) 0%,'+c.color+'55 100%)">'+
    '<div style="max-width:860px;margin:0 auto;padding:0 16px">'+
      '<button class="back-btn" onclick="_go(\'home\')">â† Back to Crops</button>'+
      '<div class="d-title">'+c.emoji+' '+c.name+'</div>'+
      '<div class="d-sub">'+c.local+' Â· '+c.cat+'</div>'+
    '</div>'+
  '</div>'+
  '<div class="detail-body">'+
    '<div class="d-stats fadeUp">'+statsHtml+'</div>'+
    '<div class="d-tabs">'+tabsHtml+'</div>'+
    content+
  '</div>';
}

function renderScanner(){
  var videoHtml='';
  if(state.camOn){
    videoHtml='<div id="video-wrap" style="position:relative;width:100%;min-height:280px;">'+
      '<div class="scan-overlay"><div class="scan-frame"><div class="sf-tl"></div><div class="sf-tr"></div><div class="sf-bl"></div><div class="sf-br"></div><div class="scan-line"></div></div></div>'+
    '</div>';
  }else if(state.capturedImg){
    videoHtml='<img src="'+state.capturedImg+'" style="width:100%;max-height:360px;object-fit:contain;background:#0a1a12;display:block;" alt="Captured crop"/>';
  }else{
    videoHtml='<div class="scan-placeholder"><div class="sp-emoji">ğŸ“·</div><div class="sp-text">Tap "Start Camera" to scan your crop for health issues using AI</div></div>';
  }
  var btnsHtml='';
  if(!state.camOn&&!state.scanning){
    btnsHtml='<button class="btn btn-green" onclick="_startCam()">ğŸ“· Start Camera</button>';
    if(state.capturedImg) btnsHtml+='<button class="btn btn-out" onclick="_startCam()">ğŸ”„ Scan Again</button>';
  }else if(state.camOn){
    btnsHtml='<button class="btn btn-amber" onclick="_capture()">ğŸ” Scan and Analyze</button><button class="btn btn-out" onclick="_stopCam()">Stop</button>';
  }
  var resultHtml='';
  if(state.scanning){
    resultHtml='<div class="analyzing-card"><div class="analyzing-emoji">ğŸ”¬</div><div style="color:var(--soft);margin-bottom:8px">AI is analyzing your crop image...</div><div style="font-size:.83rem;color:var(--soft)">Checking for diseases, pests, and nutrient deficiencies</div></div>';
  }else if(state.result){
    var r=parseResult(state.result);
    if(r){
      resultHtml='<div class="result-card">'+
        '<div class="result-hd">'+
          '<span class="r-status '+statusCls(r.status)+'">'+esc(r.status)+'</span>'+
          (r.urgency?'<span class="r-status '+(r.urgency==='HIGH'?'rs-bad':r.urgency==='MEDIUM'?'rs-warn':'rs-good')+'">âš¡ '+esc(r.urgency)+' URGENCY</span>':'')+
        '</div>'+
        (r.condition?'<div class="r-condition">'+esc(r.condition)+'</div>':'')+
        (r.observations&&r.observations.length?'<div class="r-section-lbl">Observations</div>'+r.observations.map(function(o){return '<div class="r-item"><span style="color:var(--gl);flex-shrink:0">â—</span> '+esc(o)+'</div>';}).join(''):'')+
        (r.recommendations&&r.recommendations.length?'<div class="r-rec-box"><div class="r-section-lbl" style="color:var(--gm)">ğŸ’Š Recommendations</div>'+r.recommendations.map(function(rc,i){return '<div class="r-item"><span style="color:var(--amber);font-weight:700;flex-shrink:0">'+(i+1)+'.</span> '+esc(rc)+'</div>';}).join('')+'</div>':'')+
      '</div>';
    }
  }
  return '<div class="hero" style="padding:40px 20px 48px">'+
    '<div class="hero-inner">'+
      '<div class="hero-badge">ğŸ¤– AI-Powered Â· Claude Vision</div>'+
      '<h1 class="fadeUp">Crop Health <span>Scanner</span></h1>'+
      '<p class="fadeUp d1">Point your camera at a crop leaf, stem, or pod to get instant AI diagnosis and treatment advice.</p>'+
    '</div>'+
  '</div>'+
  '<div class="scanner-section" style="padding-top:32px">'+
    '<div class="scan-box">'+
      '<div class="scan-video-wrap" style="background:#0a1a12;min-height:280px;display:flex;align-items:center;justify-content:center;">'+videoHtml+'</div>'+
      '<div class="scan-controls"><div class="scan-btns">'+btnsHtml+'</div><div class="scan-tip">Best results: good lighting Â· focus on affected area Â· hold steady</div></div>'+
    '</div>'+
    resultHtml+
    '<div class="pwa-note">ğŸ’¡ Tip: Use Chrome on Android or Safari on iOS for best camera performance</div>'+
  '</div>';
}

function renderScheduler(){
  var n=state.now;
  var season=getSeason(n.getMonth()+1);
  var locTxt=state.loc?(state.loc.lat+'N'):'Get Location';
  var y=state.calMonth.getFullYear(),m=state.calMonth.getMonth();
  var dim=new Date(y,m+1,0).getDate();
  var first=new Date(y,m,1).getDay();
  var evs=getEvents();
  var cells='';
  for(var i=0;i<first;i++) cells+='<div class="cal-d empty"></div>';
  for(var d=1;d<=dim;d++){
    var isToday=d===n.getDate()&&m===n.getMonth()&&y===n.getFullYear();
    var hasEv=evs.some(function(e){return e.day===d&&e.month===m;});
    cells+='<div class="cal-d'+(isToday?' today':'')+(hasEv?' has-ev':'')+'">'+d+'</div>';
  }
  var ssHtml=SEASONS.map(function(s){
    var isNow=s.months.includes(n.getMonth()+1);
    return '<div class="ss-item'+(isNow?' now':'')+'">'+
      '<div class="ss-sicon">'+s.icon+'</div>'+
      '<div class="ss-name">'+s.name+'</div>'+
      '<div class="ss-months">'+s.months.map(function(mm){return MONTHS[mm-1].slice(0,3);}).join(', ')+'</div>'+
    '</div>';
  }).join('');
  var evHtml=evs.map(function(ev,i){
    return '<div class="ev-card fadeUp d'+(Math.min(i+1,8))+'">'+
      '<div class="ev-date"><div class="ev-day">'+ev.day+'</div><div class="ev-mo">'+MONTHS[ev.month].slice(0,3)+'</div></div>'+
      '<div class="ev-info"><div class="ev-title">'+ev.cropName+' â€” '+ev.phase+'</div><div class="ev-desc">'+ev.desc.substring(0,75)+'...</div></div>'+
      '<div class="ev-emoji">'+ev.emoji+'</div>'+
    '</div>';
  }).join('');
  return '<div class="hero" style="padding:40px 20px 48px">'+
    '<div class="hero-inner">'+
      '<div class="hero-badge">ğŸ“… Season Aware Â· Device Time</div>'+
      '<h1 class="fadeUp">Planting <span>Scheduler</span></h1>'+
      '<p class="fadeUp d1">Track your crop cycles aligned with Ghana\'s agricultural seasons and your device\'s live date and time.</p>'+
    '</div>'+
  '</div>'+
  '<div class="sched-section" style="padding-top:32px">'+
    '<div class="live-clock fadeUp">'+
      '<div>'+
        '<div class="lc-lbl">Live Date and Time</div>'+
        '<div class="lc-date" id="sched-date">'+n.toLocaleDateString('en-GH',{weekday:'long',day:'numeric',month:'long',year:'numeric'})+'</div>'+
        '<div class="lc-time" id="sched-time">'+n.toLocaleTimeString('en-GH',{hour:'2-digit',minute:'2-digit',second:'2-digit'})+'</div>'+
      '</div>'+
      '<div style="text-align:right">'+
        '<div style="font-size:2rem">'+season.icon+'</div>'+
        '<div style="font-weight:700;color:var(--gd);font-size:.88rem">'+season.name+'</div>'+
        '<button class="loc-btn" style="margin-top:6px" onclick="_loc()">ğŸ“ '+locTxt+'</button>'+
      '</div>'+
    '</div>'+
    '<div style="max-width:860px;margin:0 auto;padding:0 0 16px">'+
      '<div class="sec-title" style="font-size:1.1rem;margin-bottom:10px">ğŸŒ Ghana Agricultural Seasons</div>'+
      '<div class="season-strip">'+ssHtml+'</div>'+
    '</div>'+
    '<div class="cal-card fadeUp">'+
      '<div class="cal-nav">'+
        '<button class="cal-nav-btn" onclick="_calPrev()">&#x2039;</button>'+
        '<div class="cal-month-lbl">'+MONTHS[m]+' '+y+'</div>'+
        '<button class="cal-nav-btn" onclick="_calNext()">&#x203A;</button>'+
      '</div>'+
      '<div class="cal-grid">'+DAYS.map(function(d){return '<div class="cal-hd">'+d+'</div>';}).join('')+cells+'</div>'+
      '<div class="cal-legend"><span><span class="leg-dot" style="background:var(--gd)"></span>Today</span><span><span class="leg-dot" style="background:var(--amber);border-radius:50%"></span>Crop Event</span></div>'+
    '</div>'+
    '<div>'+
      '<div class="sec-title" style="font-size:1.2rem;margin-bottom:14px">ğŸ“Œ Upcoming Activities</div>'+
      '<div class="events-list">'+evHtml+'</div>'+
    '</div>'+
  '</div>';
}

// â”€â”€ MAIN RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render(){
  var pg=state.page;
  var content='';
  if(pg==='home')content=renderHome();
  else if(pg==='detail')content=renderDetail();
  else if(pg==='scanner')content=renderScanner();
  else if(pg==='scheduler')content=renderScheduler();
  var nav='<nav class="nav">'+
    '<div class="nav-logo" onclick="_go(\'home\')">ğŸŒ¿ <span>AgricEnt.</span></div>'+
    '<div class="nav-tabs">'+
      [
        {id:'home',icon:'ğŸ ',lbl:'Crops'},
        {id:'scanner',icon:'ğŸ“·',lbl:'Scanner'},
        {id:'scheduler',icon:'ğŸ“…',lbl:'Schedule'}
      ].map(function(t){
        var isActive=(pg===t.id||(pg==='detail'&&t.id==='home'));
        return '<button class="nav-tab'+(isActive?' active':'')+'" onclick="_go(\''+t.id+'\')">'+t.icon+' <span class="tab-lbl">'+t.lbl+'</span></button>';
      }).join('')+
    '</div>'+
  '</nav>';
  document.getElementById('root').innerHTML=renderInstallBanner()+nav+'<main class="main">'+content+'</main>';
  if(state.camOn){
    var wrap=document.getElementById('video-wrap');
    if(wrap&&!wrap.contains(videoEl)) wrap.appendChild(videoEl);
  }
}
render();
</script>
</body>
</html>
